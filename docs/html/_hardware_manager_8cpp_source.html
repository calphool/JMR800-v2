<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JMR800 v2: src/HardwareManager.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">JMR800 v2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_hardware_manager_8cpp_source.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">HardwareManager.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="_hardware_manager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;EEPROM.h&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &quot;<a class="code" href="_hardware_manager_8h.html">HardwareManager.h</a>&quot;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="defines_8h.html">defines.h</a>&quot;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="_logging_8h.html">Logging.h</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">// Global instance</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno"><a class="line" href="_hardware_manager_8h.html#a7480f085f55ce385142af9e9a75b3038">   16</a></span><a class="code hl_class" href="class_hardware_manager.html">HardwareManager</a> <a class="code hl_variable" href="_hardware_manager_8h.html#a7480f085f55ce385142af9e9a75b3038">hardware</a>;</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">HardwareManager::bitIndex</a> = -1;</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="keyword">volatile</span> uint16_t <a class="code hl_variable" href="class_hardware_manager.html#acfc375a757daaa27f18d76c67f18307f">HardwareManager::sendBuffer</a> = 0;</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span></div>
<div class="foldopen" id="foldopen00028" data-start="{" data-end="}">
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#acbee566327ea9e237566823f46dfcac5">   28</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#acbee566327ea9e237566823f46dfcac5">HardwareManager::init</a>() {</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a">LOG_VERBOSE</a>, <span class="stringliteral">&quot;Entering HardwareManager-&gt;init()&quot;</span>);</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>    </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    EEPROM.begin();</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>    <a class="code hl_function" href="class_hardware_manager.html#aaf70a4835af8352a2af86b9679b89d41">loadKnobs</a>(); </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    <a class="code hl_variable" href="class_hardware_manager.html#a48dad7203dfb3cdaa646678c0f4f16b4">encoderKnob</a> = <span class="keyword">new</span> Encoder(<a class="code hl_define" href="defines_8h.html#a69905d626cf4151cb01579783c88c863">ENCODER_CLK_PIN</a>, <a class="code hl_define" href="defines_8h.html#ac85e335442c235cb773d5742c9ef85bb">ENCODER_DT_PIN</a>);</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    pinMode(<a class="code hl_define" href="defines_8h.html#a541f931e7d08042d778592d4f38bd403">PUSH_BTN_SW4_PIN</a>, INPUT_PULLUP);</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    pinMode(<a class="code hl_define" href="defines_8h.html#a080eb3794855f7da383bb3d59aa51b86">PUSH_BTN_SW3_PIN</a>, INPUT_PULLUP);</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    pinMode(<a class="code hl_define" href="defines_8h.html#a3e2406b11040fab176d3ae938bb36fb4">PUSH_BTN_SW2_PIN</a>, INPUT_PULLUP);</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    pinMode(<a class="code hl_define" href="defines_8h.html#a1ee5f4c034a6dbd7f5f9d30a7c7621d7">PUSH_BTN_SW1_PIN</a>, INPUT_PULLUP);</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    pinMode(<a class="code hl_define" href="defines_8h.html#ae80cab24ae384f8a20b28d725e0761a8">ENCODER_SW_PIN</a>,   INPUT_PULLUP);</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    pinMode(<a class="code hl_define" href="defines_8h.html#a69905d626cf4151cb01579783c88c863">ENCODER_CLK_PIN</a>,  INPUT);</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    pinMode(<a class="code hl_define" href="defines_8h.html#ac85e335442c235cb773d5742c9ef85bb">ENCODER_DT_PIN</a>,   INPUT);</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    pinMode(<a class="code hl_define" href="defines_8h.html#a7e66659a0a4957d6723f5d750a08a14d">SHIFT_REG_SER</a>,    OUTPUT);</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    pinMode(<a class="code hl_define" href="defines_8h.html#a3c79e4c4e3c98acfbb5ce2610850c837">SHIFT_REG_SRCLK</a>,  OUTPUT);</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    pinMode(<a class="code hl_define" href="defines_8h.html#ad35e229b7d7271d26abe3244374f7159">SHIFT_REG_RCLK</a>,   OUTPUT);</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <span class="keywordflow">for</span>(uint i = 0; i &lt; <a class="code hl_define" href="defines_8h.html#a006a61e230d20d998a18bf2fbf562947">NUM_MUXES</a>; i++) {</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>      pinMode(this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#ac54dcfe2d8157035648e18095430633d">enablePins</a>[i], OUTPUT);             <span class="comment">// set enable pins as output</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>      digitalWrite(this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#ac54dcfe2d8157035648e18095430633d">enablePins</a>[i], HIGH);          <span class="comment">// disable enable pins</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    }</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="keywordflow">for</span>(uint i = 0; i &lt; 4; i++) {</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>      pinMode(this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#a315dc1caa02e610f91b1a612bda30b3f">MuxAddressPins</a>[i], OUTPUT);         <span class="comment">// set mux pins as output</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>      digitalWrite(this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#a315dc1caa02e610f91b1a612bda30b3f">MuxAddressPins</a>[i], LOW);       <span class="comment">// set them all low</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    }</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    pinMode(<a class="code hl_define" href="defines_8h.html#ae6596c668bf9f30d1c6a52785ae33f79">READYOUT_PIN</a>, OUTPUT);</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    digitalWrite(<a class="code hl_define" href="defines_8h.html#ae6596c668bf9f30d1c6a52785ae33f79">READYOUT_PIN</a>, LOW);</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    pinMode(<a class="code hl_define" href="defines_8h.html#aaf8543438455236887373a4b15f25ce8">CLOCK_IN_PIN</a>, INPUT_PULLUP);</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    pinMode(<a class="code hl_define" href="defines_8h.html#a3cee117709e9b71f2384746e11d846b8">DATA_OUT_PIN</a>, OUTPUT);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    digitalWrite(<a class="code hl_define" href="defines_8h.html#ae6596c668bf9f30d1c6a52785ae33f79">READYOUT_PIN</a>, LOW);</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a">LOG_VERBOSE</a>, <span class="stringliteral">&quot;Setting up ADC...&quot;</span>);</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <a class="code hl_variable" href="class_hardware_manager.html#a2e85929fcd71e50c6913d623577dbeb8">adc</a>.adc0-&gt;setAveraging(4);</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <a class="code hl_variable" href="class_hardware_manager.html#a2e85929fcd71e50c6913d623577dbeb8">adc</a>.adc0-&gt;setConversionSpeed(ADC_CONVERSION_SPEED::MED_SPEED);</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <a class="code hl_variable" href="class_hardware_manager.html#a2e85929fcd71e50c6913d623577dbeb8">adc</a>.adc0-&gt;setSamplingSpeed(ADC_SAMPLING_SPEED::MED_SPEED); </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a">LOG_VERBOSE</a>, <span class="stringliteral">&quot;Attaching interrupts...&quot;</span>);</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span> </div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    attachInterrupt(digitalPinToInterrupt(<a class="code hl_define" href="defines_8h.html#aaf8543438455236887373a4b15f25ce8">CLOCK_IN_PIN</a>), <a class="code hl_function" href="class_hardware_manager.html#ae436f35ee0851ca0dad3f0f0c9ad83ea">HardwareManager::onPG800ClockFall</a>, FALLING);</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a">LOG_VERBOSE</a>, <span class="stringliteral">&quot;Setting up DAC tables...&quot;</span>);</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="keywordflow">for</span>(uint8_t i=0; i&lt; <a class="code hl_define" href="defines_8h.html#a006a61e230d20d998a18bf2fbf562947">NUM_MUXES</a>; i++) {</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        <span class="keywordflow">for</span>(uint8_t j=0;j&lt;16;j++) {</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <a class="code hl_variable" href="class_hardware_manager.html#a8f6720aad631557b7254da5f7ff356ed">AnalogValues</a>[j][i] = 0;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>            <a class="code hl_variable" href="class_hardware_manager.html#a53cce0263086fe32524936c007293847">oldAnalogValues</a>[j][i] = 0;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        }</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    }</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span> </div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <a class="code hl_variable" href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">ledstate</a> = 0b00000000;</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Initialized.&quot;</span>);</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>}</div>
</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span></div>
<div class="foldopen" id="foldopen00093" data-start="{" data-end="}">
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a0527305ad85e4875e2da02b05664fda1">   93</a></span><a class="code hl_function" href="class_hardware_manager.html#a0527305ad85e4875e2da02b05664fda1">HardwareManager::~HardwareManager</a>() {</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>  <span class="keyword">delete</span> <a class="code hl_variable" href="class_hardware_manager.html#a48dad7203dfb3cdaa646678c0f4f16b4">encoderKnob</a>;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>}</div>
</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span></div>
<div class="foldopen" id="foldopen00103" data-start="{" data-end="}">
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a5ad8de42c31a9691549f22b7157919e2">  103</a></span><span class="keywordtype">long</span> <a class="code hl_function" href="class_hardware_manager.html#a5ad8de42c31a9691549f22b7157919e2">HardwareManager::getEncoderZeroTo</a>(<span class="keywordtype">long</span> divisor) {</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="keywordtype">long</span> i = (<a class="code hl_variable" href="class_hardware_manager.html#af4761cefe4c6093de549ae7e5dde75b9">lastEncoderPosition</a>&gt;&gt;2) % divisor; </div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <span class="keywordflow">if</span>(i &lt; 0)</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>      i = 0;</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <span class="keywordflow">if</span>(i &gt; divisor)</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>      i = divisor-1;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <span class="keywordflow">return</span> i;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>}</div>
</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span></div>
<div class="foldopen" id="foldopen00118" data-start="{" data-end="}">
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#aaf70a4835af8352a2af86b9679b89d41">  118</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#aaf70a4835af8352a2af86b9679b89d41">HardwareManager::loadKnobs</a>() {</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="defines_8h.html#a87f435a777fc58e1d3c4630bb8e632b3">NUM_KNOBS</a>; i++) {</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="keywordtype">int</span> addr = i * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structknob_config.html">knobConfig</a>);</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    EEPROM.get(addr, <a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[i]);</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="keywordflow">while</span>(strlen(<a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[i].name) &lt; 14)</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>      strcat(<a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[i].name,<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>  }</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>  memcpy(<a class="code hl_variable" href="class_hardware_manager.html#a5a834a463d4b5ef9e69a37001c60768e">knobConfigurations_bkup</a>, <a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>));</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>}</div>
</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span></div>
<div class="foldopen" id="foldopen00132" data-start="{" data-end="}">
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a323515123ec033d7e4761cd1ad0f7674">  132</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#a323515123ec033d7e4761cd1ad0f7674">HardwareManager::saveKnobs</a>() {</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="defines_8h.html#a87f435a777fc58e1d3c4630bb8e632b3">NUM_KNOBS</a>; i++) {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="keywordflow">while</span>(strlen(<a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[i].name) &lt; 14)</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>      strcat(<a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[i].name,<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="keywordtype">int</span> addr = i * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structknob_config.html">knobConfig</a>);</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="class_hardware_manager.html#a8ccfd2a833eb6826587dba7a4d97c331">knobChanged</a>(i)) { <span class="comment">// optimization that reduces wear on EEPROM</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>      EEPROM.put(addr, <a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[i]);</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>      <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;knob changed:     &quot;</span> + String(i));</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    }</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>      <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a">LOG_VERBOSE</a>, <span class="stringliteral">&quot;knob not changed: &quot;</span> + String(i));</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    }</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>  }</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>  memcpy(<a class="code hl_variable" href="class_hardware_manager.html#a5a834a463d4b5ef9e69a37001c60768e">knobConfigurations_bkup</a>, <a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>));</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>}</div>
</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span></div>
<div class="foldopen" id="foldopen00156" data-start="{" data-end="}">
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a8ccfd2a833eb6826587dba7a4d97c331">  156</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="class_hardware_manager.html#a8ccfd2a833eb6826587dba7a4d97c331">HardwareManager::knobChanged</a>(<span class="keywordtype">int</span> i) {</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>  <span class="keywordflow">return</span> memcmp(&amp;<a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[i], &amp;<a class="code hl_variable" href="class_hardware_manager.html#a5a834a463d4b5ef9e69a37001c60768e">knobConfigurations_bkup</a>[i], <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structknob_config.html">knobConfig</a>)) != 0;</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>}</div>
</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span></div>
<div class="foldopen" id="foldopen00164" data-start="{" data-end="}">
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a6f45e846ef082a37a2bd2d3edf9efb5b">  164</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#a6f45e846ef082a37a2bd2d3edf9efb5b">HardwareManager::loop</a>() {</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="keywordflow">if</span> (millis() - <a class="code hl_variable" href="class_hardware_manager.html#a26b5a0c399598a73399c33cb42195404">lastPollTime</a> &lt; <a class="code hl_variable" href="class_hardware_manager.html#a6a90392542468cb4d057b7e1aa3b2aad">hardwareManagerPollIntervalMS</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <a class="code hl_variable" href="class_hardware_manager.html#a26b5a0c399598a73399c33cb42195404">lastPollTime</a> = millis();</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <a class="code hl_function" href="class_hardware_manager.html#a4a7cab7ae0b5071b0557905000f46806">gatherControlSettings</a>();</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>}</div>
</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="foldopen" id="foldopen00172" data-start="{" data-end="};">
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno"><a class="line" href="_hardware_manager_8cpp.html#abdb55660f2760f6fe0f0455db948dcc0">  172</a></span><span class="keyword">static</span> <span class="keyword">const</span> uint <a class="code hl_variable" href="_hardware_manager_8cpp.html#abdb55660f2760f6fe0f0455db948dcc0">knobXformer</a>[] = {</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> 32,33,34,35,36,37,38,39,40,41, 42, 43, 44, 45, 46, 47,</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> 16,17,18,19,20,21,22,23,24,25, 26, 27, 28, 29, 30, 31,</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> 48,49,50,51,52,53,54,55</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>};</div>
</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span></div>
<div class="foldopen" id="foldopen00186" data-start="{" data-end="}">
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a389138f42e4c27721988b5f6482a47c1">  186</a></span><span class="keywordtype">int</span> <a class="code hl_function" href="class_hardware_manager.html#a389138f42e4c27721988b5f6482a47c1">HardwareManager::getKnobValue</a>(uint knobIX) {</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>  knobIX = <a class="code hl_variable" href="_hardware_manager_8cpp.html#abdb55660f2760f6fe0f0455db948dcc0">knobXformer</a>[knobIX];              <span class="comment">// transform this index (necessary because of wiring) </span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>  uint mux = knobIX &gt;&gt; 4;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>  uint mux_ix = knobIX &amp; 0x0F;</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>  <span class="keywordflow">return</span> 255-(this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#a8f6720aad631557b7254da5f7ff356ed">AnalogValues</a>[mux_ix][mux]);</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>}</div>
</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span></div>
<div class="foldopen" id="foldopen00200" data-start="{" data-end="}">
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#ac05c3327a4bedb62f953d15f64c98348">  200</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="class_hardware_manager.html#ac05c3327a4bedb62f953d15f64c98348">HardwareManager::isButtonPressed</a>(uint index) {</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="keywordflow">if</span>(index &gt;= <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a>) {</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>      <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;HardwareManager::isButtonPressed() invoked with index larger than number of defined buttons.&quot;</span>);</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[0];</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    }</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[index];</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>}</div>
</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span></div>
<div class="foldopen" id="foldopen00219" data-start="{" data-end="}">
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a4a7cab7ae0b5071b0557905000f46806">  219</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#a4a7cab7ae0b5071b0557905000f46806">HardwareManager::gatherControlSettings</a>() {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>  this-&gt;<a class="code hl_function" href="class_hardware_manager.html#ab2810a18f676cb33b5696d59a61caf1b">gatherPotentiometerValues</a>();</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a>; i++)</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <a class="code hl_variable" href="class_hardware_manager.html#ad30a99fa8e93d030b058e41f6e60dcae">prevButtonStates</a>[i] = <a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[i];</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a>; i++)</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[i] = !digitalRead(<a class="code hl_variable" href="class_hardware_manager.html#a627129bb20508846f14c1f62220a4976">buttonPins</a>[i]); <span class="comment">// Active low</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span> </div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>  <a class="code hl_variable" href="class_hardware_manager.html#ac803df51783435becad4e0719e3de1d3">bPrevEncoderBtn</a> = <a class="code hl_variable" href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">bEncoderBtn</a>;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>  <a class="code hl_variable" href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">bEncoderBtn</a> = !digitalRead(<a class="code hl_define" href="defines_8h.html#ae80cab24ae384f8a20b28d725e0761a8">ENCODER_SW_PIN</a>);</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>  this-&gt;<a class="code hl_function" href="class_hardware_manager.html#a04393ce5c07558f919f4473049543260">updateEncoder</a>();  </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>}</div>
</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span></div>
<div class="foldopen" id="foldopen00240" data-start="{" data-end="}">
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#abd678fae41765624bb05aed23f7a1785">  240</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="class_hardware_manager.html#abd678fae41765624bb05aed23f7a1785">HardwareManager::redIsLit</a>(uint buttonId) {</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  <span class="keywordflow">if</span>(buttonId &gt;= <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a>) {</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;invalid button number passed to HardwareManager::redIsLit()&quot;</span>);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>  }</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>  </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>  buttonId = <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a> - 1 - buttonId;</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  uint bitPos = buttonId * 2; <span class="comment">// Red LED bit</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>  <span class="keywordflow">return</span> (<a class="code hl_variable" href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">ledstate</a> &amp; (1 &lt;&lt; bitPos)) != 0;</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>}</div>
</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span> </div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span></div>
<div class="foldopen" id="foldopen00258" data-start="{" data-end="}">
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a598987bc3663dc83206abb5d1d2119f5">  258</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="class_hardware_manager.html#a598987bc3663dc83206abb5d1d2119f5">HardwareManager::greenIsLit</a>(uint buttonId) {</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  <span class="keywordflow">if</span>(buttonId &gt;= <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a>) {</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;invalid button number passed to HardwareManager::greenIsLit()&quot;</span>);</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  }</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  buttonId = <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a> - 1 - buttonId;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>  uint bitPos = buttonId * 2 + 1; <span class="comment">// Green LED bit</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>  <span class="keywordflow">return</span> (<a class="code hl_variable" href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">ledstate</a> &amp; (1 &lt;&lt; bitPos)) != 0;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>}</div>
</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span></div>
<div class="foldopen" id="foldopen00277" data-start="{" data-end="}">
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a245e2fe92421b95d708377e7b6ca6711">  277</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="class_hardware_manager.html#a245e2fe92421b95d708377e7b6ca6711">HardwareManager::encoderSwitchStateChanged</a>(<span class="keywordtype">bool</span> upThenDown, <span class="keywordtype">bool</span> clearFlag) {</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">bEncoderBtn</a> != <a class="code hl_variable" href="class_hardware_manager.html#ac803df51783435becad4e0719e3de1d3">bPrevEncoderBtn</a>) {</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="keywordflow">if</span>(upThenDown) {</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">bEncoderBtn</a> == LOW &amp;&amp; <a class="code hl_variable" href="class_hardware_manager.html#ac803df51783435becad4e0719e3de1d3">bPrevEncoderBtn</a> == HIGH) {</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        <span class="keywordflow">if</span>(clearFlag) <a class="code hl_variable" href="class_hardware_manager.html#ac803df51783435becad4e0719e3de1d3">bPrevEncoderBtn</a> = <a class="code hl_variable" href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">bEncoderBtn</a>;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>      }</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    }</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">bEncoderBtn</a> == HIGH &amp;&amp; <a class="code hl_variable" href="class_hardware_manager.html#ac803df51783435becad4e0719e3de1d3">bPrevEncoderBtn</a> == LOW) {</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        <span class="keywordflow">if</span>(clearFlag) <a class="code hl_variable" href="class_hardware_manager.html#ac803df51783435becad4e0719e3de1d3">bPrevEncoderBtn</a> = <a class="code hl_variable" href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">bEncoderBtn</a>;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>      }</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    }</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>  }</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>}</div>
</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span></div>
<div class="foldopen" id="foldopen00304" data-start="{" data-end="}">
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a73027e69fad5aa613c3fe4ed0af7b6da">  304</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="class_hardware_manager.html#a73027e69fad5aa613c3fe4ed0af7b6da">HardwareManager::buttonStateChanged</a>(uint index, <span class="keywordtype">bool</span> upThenDown, <span class="keywordtype">bool</span> clearFlag) {</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>  <span class="keywordflow">if</span>(index &gt;= <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a>) {</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;invalid button number passed to HardwareManager::buttonStateChanged()&quot;</span>);</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>  }</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[index] != <a class="code hl_variable" href="class_hardware_manager.html#ad30a99fa8e93d030b058e41f6e60dcae">prevButtonStates</a>[index]) {</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    <span class="keywordflow">if</span>(upThenDown) {</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[index] == LOW &amp;&amp; <a class="code hl_variable" href="class_hardware_manager.html#ad30a99fa8e93d030b058e41f6e60dcae">prevButtonStates</a>[index] == HIGH) {</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <span class="keywordflow">if</span>(clearFlag) <a class="code hl_variable" href="class_hardware_manager.html#ad30a99fa8e93d030b058e41f6e60dcae">prevButtonStates</a>[index] = <a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[index];</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>; </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>      }</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    }</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[index] == HIGH &amp;&amp; <a class="code hl_variable" href="class_hardware_manager.html#ad30a99fa8e93d030b058e41f6e60dcae">prevButtonStates</a>[index] == LOW) {</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        <span class="keywordflow">if</span>(clearFlag) <a class="code hl_variable" href="class_hardware_manager.html#ad30a99fa8e93d030b058e41f6e60dcae">prevButtonStates</a>[index] = <a class="code hl_variable" href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">buttonStates</a>[index];        </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>      }</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    }</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>  }</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>}</div>
</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span></div>
<div class="foldopen" id="foldopen00337" data-start="{" data-end="}">
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#ab2810a18f676cb33b5696d59a61caf1b">  337</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#ab2810a18f676cb33b5696d59a61caf1b">HardwareManager::gatherPotentiometerValues</a>() {</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>  <a class="code hl_variable" href="class_hardware_manager.html#a10c40b44979b1ee9d1de1befd26d3a44">iGatherCtr</a>++;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>  <a class="code hl_variable" href="class_hardware_manager.html#a9b7836f6542d76f66a18dd266c8ff268">lastPotScanTime</a> = millis();</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>  <span class="keywordflow">for</span>(uint8_t muxCtr = 0; muxCtr &lt; <a class="code hl_define" href="defines_8h.html#a006a61e230d20d998a18bf2fbf562947">NUM_MUXES</a>; muxCtr++) {</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>      digitalWrite(this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#ac54dcfe2d8157035648e18095430633d">enablePins</a>[muxCtr], LOW);  <span class="comment">// enable this mux</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>      <span class="keywordflow">for</span>(uint8_t addr = 0; addr &lt; 16; addr++) {</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>        this-&gt;<a class="code hl_function" href="class_hardware_manager.html#aef067455e10624433ddd360794012151">setAddressPins</a>(addr);</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>        uint16_t raw = <a class="code hl_variable" href="class_hardware_manager.html#a2e85929fcd71e50c6913d623577dbeb8">adc</a>.adc0-&gt;analogRead(<a class="code hl_variable" href="class_hardware_manager.html#a8ad6a46ff803f39bbe5c7b99d5dc1118">analogInPins</a>[muxCtr]);</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>        raw = raw &gt;&gt; 2;          <span class="comment">// (1024 / 4 = 256)</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>        raw = ((this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#a8f6720aad631557b7254da5f7ff356ed">AnalogValues</a>[addr][muxCtr]) * 7 + raw) &gt;&gt; 3;  <span class="comment">// smoothed value (multiplies original value by 7 then adds new, then averages)</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#a8f6720aad631557b7254da5f7ff356ed">AnalogValues</a>[addr][muxCtr] = raw;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        <span class="keywordflow">if</span>(<a class="code hl_variable" href="class_hardware_manager.html#a10c40b44979b1ee9d1de1befd26d3a44">iGatherCtr</a> % 10 == 0) <span class="comment">// store a copy of the current AnalogValues() periodically</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            <a class="code hl_variable" href="class_hardware_manager.html#a53cce0263086fe32524936c007293847">oldAnalogValues</a>[addr][muxCtr] = this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#a8f6720aad631557b7254da5f7ff356ed">AnalogValues</a>[addr][muxCtr];</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>      }</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>      digitalWrite(this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#ac54dcfe2d8157035648e18095430633d">enablePins</a>[muxCtr], HIGH); <span class="comment">// disable this mux</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>      delayMicroseconds(5);</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>  }</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>}</div>
</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span></div>
<div class="foldopen" id="foldopen00362" data-start="{" data-end="}">
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#aef067455e10624433ddd360794012151">  362</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#aef067455e10624433ddd360794012151">HardwareManager::setAddressPins</a>(uint val) {</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>  <span class="keywordflow">if</span>(val &amp; 0x01) digitalWrite(<a class="code hl_define" href="defines_8h.html#a44723db4e11f34a0ad8759574d637e1d">S0_PIN</a>, HIGH); <span class="keywordflow">else</span> digitalWrite(<a class="code hl_define" href="defines_8h.html#a44723db4e11f34a0ad8759574d637e1d">S0_PIN</a>, LOW);</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>  <span class="keywordflow">if</span>(val &amp; 0x02) digitalWrite(<a class="code hl_define" href="defines_8h.html#a8766620bcdd3b4ffdae69e99def6458e">S1_PIN</a>, HIGH); <span class="keywordflow">else</span> digitalWrite(<a class="code hl_define" href="defines_8h.html#a8766620bcdd3b4ffdae69e99def6458e">S1_PIN</a>, LOW);</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>  <span class="keywordflow">if</span>(val &amp; 0x04) digitalWrite(<a class="code hl_define" href="defines_8h.html#ad50338afe7b10c1aa188fde925109853">S2_PIN</a>, HIGH); <span class="keywordflow">else</span> digitalWrite(<a class="code hl_define" href="defines_8h.html#ad50338afe7b10c1aa188fde925109853">S2_PIN</a>, LOW);</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>  <span class="keywordflow">if</span>(val &amp; 0x08) digitalWrite(<a class="code hl_define" href="defines_8h.html#aeff05ff93deed7ec7c197dfded858bda">S3_PIN</a>, HIGH); <span class="keywordflow">else</span> digitalWrite(<a class="code hl_define" href="defines_8h.html#aeff05ff93deed7ec7c197dfded858bda">S3_PIN</a>, LOW);</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>  delayMicroseconds(5);</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>}</div>
</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span></div>
<div class="foldopen" id="foldopen00375" data-start="{" data-end="}">
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a7777c52d0ef47ddf60e84beeedf39cc0">  375</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#a7777c52d0ef47ddf60e84beeedf39cc0">HardwareManager::resetEncoder</a>(uint i) {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>  <a class="code hl_variable" href="class_hardware_manager.html#a48dad7203dfb3cdaa646678c0f4f16b4">encoderKnob</a>-&gt;write(i);</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>}</div>
</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span></div>
<div class="foldopen" id="foldopen00383" data-start="{" data-end="}">
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a04393ce5c07558f919f4473049543260">  383</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#a04393ce5c07558f919f4473049543260">HardwareManager::updateEncoder</a>() {</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>  <span class="keywordtype">long</span> newPosition = <a class="code hl_variable" href="class_hardware_manager.html#a48dad7203dfb3cdaa646678c0f4f16b4">encoderKnob</a>-&gt;read();</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span> </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>  <span class="keywordflow">if</span>(newPosition &lt; 0) {</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <a class="code hl_variable" href="class_hardware_manager.html#a48dad7203dfb3cdaa646678c0f4f16b4">encoderKnob</a>-&gt;write(0);</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    newPosition = 0;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>  }</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>  <span class="keywordflow">if</span> (newPosition != <a class="code hl_variable" href="class_hardware_manager.html#af4761cefe4c6093de549ae7e5dde75b9">lastEncoderPosition</a>) {</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    <span class="keywordflow">if</span> (newPosition &gt; <a class="code hl_variable" href="class_hardware_manager.html#af4761cefe4c6093de549ae7e5dde75b9">lastEncoderPosition</a>) {</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>      <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a">LOG_VERBOSE</a>, <span class="stringliteral">&quot;CCW &quot;</span> + String(<a class="code hl_variable" href="class_hardware_manager.html#af4761cefe4c6093de549ae7e5dde75b9">lastEncoderPosition</a>&gt;&gt;2));</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>      <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a">LOG_VERBOSE</a>, <span class="stringliteral">&quot;CW  &quot;</span> + String(<a class="code hl_variable" href="class_hardware_manager.html#af4761cefe4c6093de549ae7e5dde75b9">lastEncoderPosition</a>&gt;&gt;2));</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    }</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span> </div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    <a class="code hl_variable" href="class_hardware_manager.html#af4761cefe4c6093de549ae7e5dde75b9">lastEncoderPosition</a> = newPosition;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>  }</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>}</div>
</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span></div>
<div class="foldopen" id="foldopen00407" data-start="{" data-end="}">
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#aaa16c700ab58fcc9b2b8a33ff4f3090d">  407</a></span><span class="keywordtype">long</span> <a class="code hl_function" href="class_hardware_manager.html#aaa16c700ab58fcc9b2b8a33ff4f3090d">HardwareManager::getEncoderValue</a>() {</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="class_hardware_manager.html#af4761cefe4c6093de549ae7e5dde75b9">lastEncoderPosition</a>;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>}</div>
</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span> </div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span></div>
<div class="foldopen" id="foldopen00415" data-start="{" data-end="}">
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a69487280dacad30fc7fa1fd58e9e48ca">  415</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#a69487280dacad30fc7fa1fd58e9e48ca">HardwareManager::writeLedRegistersToHardware</a>() {</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>  <span class="comment">// make sure to check Serial before doing any logging here.  This is a low level method that gets used </span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>  <span class="comment">// before we know that logging is available.</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>  <span class="keywordtype">byte</span> data = <a class="code hl_variable" href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">ledstate</a>;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span> </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>  digitalWrite(<a class="code hl_define" href="defines_8h.html#ad35e229b7d7271d26abe3244374f7159">SHIFT_REG_RCLK</a>, LOW);  <span class="comment">// Start by disabling latch</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>  <span class="comment">// Shift out 8 bits, MSB first</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>  <span class="keywordflow">for</span> (int8_t i = 7; i &gt;= 0; i--) {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    digitalWrite(<a class="code hl_define" href="defines_8h.html#a3c79e4c4e3c98acfbb5ce2610850c837">SHIFT_REG_SRCLK</a>, LOW);  <span class="comment">// Prepare for clock</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="keywordtype">bool</span> bitVal = data &amp; (1 &lt;&lt; i);       <span class="comment">// Extract current bit</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    digitalWrite(<a class="code hl_define" href="defines_8h.html#a7e66659a0a4957d6723f5d750a08a14d">SHIFT_REG_SER</a>, bitVal); <span class="comment">// Set data line</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>    digitalWrite(<a class="code hl_define" href="defines_8h.html#a3c79e4c4e3c98acfbb5ce2610850c837">SHIFT_REG_SRCLK</a>, HIGH); <span class="comment">// Rising edge clocks bit into register</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>  }</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span> </div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>  digitalWrite(<a class="code hl_define" href="defines_8h.html#ad35e229b7d7271d26abe3244374f7159">SHIFT_REG_RCLK</a>, HIGH);    <span class="comment">// Latch data to output pins</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>}</div>
</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span> </div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span></div>
<div class="foldopen" id="foldopen00444" data-start="{" data-end="}">
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#acc9496217a58084ae0af83c58cf658ea">  444</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#acc9496217a58084ae0af83c58cf658ea">HardwareManager::sendParameter</a>(uint8_t paramID, uint8_t value) {</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> now = millis();</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span> </div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>  <span class="comment">// Remove expired entries</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>  this-&gt;<a class="code hl_variable" href="class_hardware_manager.html#a75f06e4bc04d08d6be6e61bc7e3880c9">recentCommands</a>.erase(</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    std::remove_if(<a class="code hl_variable" href="class_hardware_manager.html#a75f06e4bc04d08d6be6e61bc7e3880c9">recentCommands</a>.begin(), <a class="code hl_variable" href="class_hardware_manager.html#a75f06e4bc04d08d6be6e61bc7e3880c9">recentCommands</a>.end(),</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>      [now](<span class="keyword">const</span> <a class="code hl_struct" href="struct_sent_command.html">SentCommand</a>&amp; cmd) {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        return now - cmd.timestamp &gt; COMMAND_TIMEOUT;</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>      }),</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    this-&gt;recentCommands.end()</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>  );</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>  <span class="comment">// Check for duplicate</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cmd : <a class="code hl_variable" href="class_hardware_manager.html#a75f06e4bc04d08d6be6e61bc7e3880c9">recentCommands</a>) {</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>    <span class="keywordflow">if</span> (cmd.<a class="code hl_variable" href="struct_sent_command.html#a6bd03f07367c4a7a8033c4f2f8183fe1">paramID</a> == paramID &amp;&amp; cmd.<a class="code hl_variable" href="struct_sent_command.html#aa7341c37b068a4b56a108fb90990d102">value</a> == value) {</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>      <span class="keywordflow">return</span>;  <span class="comment">// Duplicate within timeout window; do not resend</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>    }</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>  }</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span> </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>  <span class="comment">// Record this command</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>  <a class="code hl_variable" href="class_hardware_manager.html#a75f06e4bc04d08d6be6e61bc7e3880c9">recentCommands</a>.push_back({paramID, value, now});</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>  <span class="keywordflow">while</span> (<a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">bitIndex</a> != -1 &amp;&amp; (millis() - now &lt; 250) );  <span class="comment">// Wait until previous transfer is complete</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>  <span class="keywordflow">if</span>(millis() - now &gt;= 250) {</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;problem waiting for bitIndex in sendParameter()&quot;</span>);</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>  }</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span> </div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>  noInterrupts();</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>  <a class="code hl_variable" href="class_hardware_manager.html#acfc375a757daaa27f18d76c67f18307f">sendBuffer</a> = ((uint16_t)paramID &lt;&lt; 8) | value;</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>  <a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">bitIndex</a> = 15;</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>  <span class="keywordtype">bool</span> bit = (<a class="code hl_variable" href="class_hardware_manager.html#acfc375a757daaa27f18d76c67f18307f">sendBuffer</a> &gt;&gt; <a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">bitIndex</a>) &amp; 1;</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>  digitalWrite(<a class="code hl_define" href="defines_8h.html#a3cee117709e9b71f2384746e11d846b8">DATA_OUT_PIN</a>, bit ? LOW : HIGH);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>  <a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">bitIndex</a>--;</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>  </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>  digitalWrite(<a class="code hl_define" href="defines_8h.html#ae6596c668bf9f30d1c6a52785ae33f79">READYOUT_PIN</a>, HIGH);  <span class="comment">// Begin transmission</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>  <span class="comment">//delayMicroseconds(5);</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>  interrupts();</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>}</div>
</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span> </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span></div>
<div class="foldopen" id="foldopen00493" data-start="{" data-end="}">
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#ae436f35ee0851ca0dad3f0f0c9ad83ea">  493</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#ae436f35ee0851ca0dad3f0f0c9ad83ea">HardwareManager::onPG800ClockFall</a>() {</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">bitIndex</a> &lt; 0) <span class="keywordflow">return</span>;  <span class="comment">// Not currently sending</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span> </div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>  delayMicroseconds(10);</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>  <span class="comment">// DATA is negative logic, so we invert the bit</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>  <span class="keywordtype">bool</span> bit = (<a class="code hl_variable" href="class_hardware_manager.html#acfc375a757daaa27f18d76c67f18307f">sendBuffer</a> &gt;&gt; <a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">bitIndex</a>) &amp; 1;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>  digitalWrite(<a class="code hl_define" href="defines_8h.html#a3cee117709e9b71f2384746e11d846b8">DATA_OUT_PIN</a>, bit ? LOW : HIGH);  <span class="comment">// inverted logic</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>  <a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">bitIndex</a>--;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">bitIndex</a> &lt; 0) {</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    delayMicroseconds(5);</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>    digitalWrite(<a class="code hl_define" href="defines_8h.html#ae6596c668bf9f30d1c6a52785ae33f79">READYOUT_PIN</a>, LOW);           <span class="comment">// End of transfer</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    delayMicroseconds(10);</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    digitalWrite(<a class="code hl_define" href="defines_8h.html#a3cee117709e9b71f2384746e11d846b8">DATA_OUT_PIN</a>, LOW);           <span class="comment">// Idle state</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>  }</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>}</div>
</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span></div>
<div class="foldopen" id="foldopen00513" data-start="{" data-end="}">
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a0b6ee88f01f7908e5d0bdd7f366164f4">  513</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="class_hardware_manager.html#a0b6ee88f01f7908e5d0bdd7f366164f4">HardwareManager::getEncoderSwitchStatus</a>() {</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">bEncoderBtn</a>;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>}</div>
</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span></div>
<div class="foldopen" id="foldopen00520" data-start="{" data-end="}">
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a9e49dcb61d28890a831708d669eebed6">  520</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#a9e49dcb61d28890a831708d669eebed6">HardwareManager::saveLedState</a>() {</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>  <a class="code hl_variable" href="class_hardware_manager.html#ab14567b2aa576fcbe6f8be034b3c6427">prevLedState</a> = <a class="code hl_variable" href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">ledstate</a>;</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>}</div>
</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span></div>
<div class="foldopen" id="foldopen00527" data-start="{" data-end="}">
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#aac5863c15f10f28dc888d496eadf0d70">  527</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#aac5863c15f10f28dc888d496eadf0d70">HardwareManager::restoreLedState</a>() {</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>  <a class="code hl_variable" href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">ledstate</a> = <a class="code hl_variable" href="class_hardware_manager.html#ab14567b2aa576fcbe6f8be034b3c6427">prevLedState</a>;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>}</div>
</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span></div>
<div class="foldopen" id="foldopen00537" data-start="{" data-end="}">
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#af204c2f4a3e3e12dbd79a9c910f5979c">  537</a></span><a class="code hl_struct" href="structknob_config.html">knobConfig</a> <a class="code hl_function" href="class_hardware_manager.html#af204c2f4a3e3e12dbd79a9c910f5979c">HardwareManager::getKnobConfiguration</a>(uint index) {</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>  <span class="keywordflow">if</span>(index &gt;= <a class="code hl_define" href="defines_8h.html#a87f435a777fc58e1d3c4630bb8e632b3">NUM_KNOBS</a>) {</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;HardwareManager::getKnobConfiguration() invoked with an invalid knob index&quot;</span>);</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[<a class="code hl_define" href="defines_8h.html#a87f435a777fc58e1d3c4630bb8e632b3">NUM_KNOBS</a> % index];</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>  }</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">knobConfigurations</a>[index];</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>}</div>
</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span></div>
<div class="foldopen" id="foldopen00552" data-start="{" data-end="}">
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno"><a class="line" href="class_hardware_manager.html#a518b4b1ddd898bd2a962392af422614f">  552</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_hardware_manager.html#a518b4b1ddd898bd2a962392af422614f">HardwareManager::setButtonLights</a>(uint buttonId, <span class="keywordtype">bool</span> red, <span class="keywordtype">bool</span> green) {</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>  <span class="comment">// all logging here must check whether Serial is defined because this </span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>  <span class="comment">// code gets used in the logging setup</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>  <span class="keywordflow">if</span>(buttonId &gt;= <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a>) {</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <span class="keywordflow">if</span>(Serial) <a class="code hl_function" href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a>(<a class="code hl_enumvalue" href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>, <span class="stringliteral">&quot;HardwareManager::setButtonLights() invoked with an invalid button id&quot;</span>);</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>  }</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span> </div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>  buttonId = <a class="code hl_define" href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a> - 1 - buttonId;</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>  <span class="keywordtype">int</span> shift = buttonId * 2;</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>  <span class="comment">// Clear the two bits for this button</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>  <a class="code hl_variable" href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">ledstate</a> &amp;= ~(0b11 &lt;&lt; shift);</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span> </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>  <span class="comment">// Pack red (MSB) and green (LSB) into two bits</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>  uint8_t bitsToSet = ((green ? 1 : 0) &lt;&lt; 1) | (red ? 1 : 0);</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span> </div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>  <span class="comment">// Set the new bits at the proper location</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>  <a class="code hl_variable" href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">ledstate</a> |= (bitsToSet &lt;&lt; shift);</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>  <a class="code hl_function" href="class_hardware_manager.html#a69487280dacad30fc7fa1fd58e9e48ca">writeLedRegistersToHardware</a>();</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>}</div>
</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="ttc" id="a_hardware_manager_8cpp_html_abdb55660f2760f6fe0f0455db948dcc0"><div class="ttname"><a href="_hardware_manager_8cpp.html#abdb55660f2760f6fe0f0455db948dcc0">knobXformer</a></div><div class="ttdeci">static const uint knobXformer[]</div><div class="ttdef"><b>Definition</b> <a href="#l00172">HardwareManager.cpp:172</a></div></div>
<div class="ttc" id="a_hardware_manager_8h_html"><div class="ttname"><a href="_hardware_manager_8h.html">HardwareManager.h</a></div><div class="ttdoc">Manages hardware input/output for analog controls, digital buttons, encoder, and serial communication...</div></div>
<div class="ttc" id="a_hardware_manager_8h_html_a7480f085f55ce385142af9e9a75b3038"><div class="ttname"><a href="_hardware_manager_8h.html#a7480f085f55ce385142af9e9a75b3038">hardware</a></div><div class="ttdeci">HardwareManager hardware</div><div class="ttdoc">Singleton instance of HardwareManager.</div><div class="ttdef"><b>Definition</b> <a href="#l00016">HardwareManager.cpp:16</a></div></div>
<div class="ttc" id="a_logging_8h_html"><div class="ttname"><a href="_logging_8h.html">Logging.h</a></div><div class="ttdoc">Lightweight logging utility for serial output in the JMR800-V2 project.</div></div>
<div class="ttc" id="a_logging_8h_html_a32abad09d9f828a9805862e18ad5da5f"><div class="ttname"><a href="_logging_8h.html#a32abad09d9f828a9805862e18ad5da5f">log</a></div><div class="ttdeci">void log(LogLevel level, const String &amp;message)</div><div class="ttdoc">Logs a message with an explicit log level.</div><div class="ttdef"><b>Definition</b> <a href="_logging_8cpp_source.html#l00026">Logging.cpp:26</a></div></div>
<div class="ttc" id="a_logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473"><div class="ttname"><a href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a></div><div class="ttdeci">@ LOG_ERROR</div><div class="ttdef"><b>Definition</b> <a href="_logging_8h_source.html#l00023">Logging.h:23</a></div></div>
<div class="ttc" id="a_logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837"><div class="ttname"><a href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a></div><div class="ttdeci">@ LOG_INFO</div><div class="ttdef"><b>Definition</b> <a href="_logging_8h_source.html#l00021">Logging.h:21</a></div></div>
<div class="ttc" id="a_logging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a"><div class="ttname"><a href="_logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ac74e4f8b7fa7b544b66d09e854b8773a">LOG_VERBOSE</a></div><div class="ttdeci">@ LOG_VERBOSE</div><div class="ttdef"><b>Definition</b> <a href="_logging_8h_source.html#l00020">Logging.h:20</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html"><div class="ttname"><a href="class_hardware_manager.html">HardwareManager</a></div><div class="ttdoc">Handles initialization, polling, and control of physical interface components such as buttons,...</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00033">HardwareManager.h:33</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a04393ce5c07558f919f4473049543260"><div class="ttname"><a href="class_hardware_manager.html#a04393ce5c07558f919f4473049543260">HardwareManager::updateEncoder</a></div><div class="ttdeci">void updateEncoder()</div><div class="ttdoc">Reads and updates encoder state.</div><div class="ttdef"><b>Definition</b> <a href="#l00383">HardwareManager.cpp:383</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a0527305ad85e4875e2da02b05664fda1"><div class="ttname"><a href="class_hardware_manager.html#a0527305ad85e4875e2da02b05664fda1">HardwareManager::~HardwareManager</a></div><div class="ttdeci">~HardwareManager()</div><div class="ttdoc">Destructor.</div><div class="ttdef"><b>Definition</b> <a href="#l00093">HardwareManager.cpp:93</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a0a79ed924f6537f4b28e17bfc495e840"><div class="ttname"><a href="class_hardware_manager.html#a0a79ed924f6537f4b28e17bfc495e840">HardwareManager::buttonStates</a></div><div class="ttdeci">uint8_t buttonStates[NUM_BUTTONS]</div><div class="ttdoc">Current digital button states.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00046">HardwareManager.h:46</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a0b6ee88f01f7908e5d0bdd7f366164f4"><div class="ttname"><a href="class_hardware_manager.html#a0b6ee88f01f7908e5d0bdd7f366164f4">HardwareManager::getEncoderSwitchStatus</a></div><div class="ttdeci">bool getEncoderSwitchStatus()</div><div class="ttdoc">Returns true if the encoder button is currently pressed.</div><div class="ttdef"><b>Definition</b> <a href="#l00513">HardwareManager.cpp:513</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a0f5f92a4bb0414fb777bf27a59530b0b"><div class="ttname"><a href="class_hardware_manager.html#a0f5f92a4bb0414fb777bf27a59530b0b">HardwareManager::bEncoderBtn</a></div><div class="ttdeci">bool bEncoderBtn</div><div class="ttdoc">Current encoder button state.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00053">HardwareManager.h:53</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a10c40b44979b1ee9d1de1befd26d3a44"><div class="ttname"><a href="class_hardware_manager.html#a10c40b44979b1ee9d1de1befd26d3a44">HardwareManager::iGatherCtr</a></div><div class="ttdeci">long iGatherCtr</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00035">HardwareManager.h:35</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a245e2fe92421b95d708377e7b6ca6711"><div class="ttname"><a href="class_hardware_manager.html#a245e2fe92421b95d708377e7b6ca6711">HardwareManager::encoderSwitchStateChanged</a></div><div class="ttdeci">bool encoderSwitchStateChanged(bool upThenDown, bool clearFlag)</div><div class="ttdoc">Detects state changes on encoder button.</div><div class="ttdef"><b>Definition</b> <a href="#l00277">HardwareManager.cpp:277</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a26b5a0c399598a73399c33cb42195404"><div class="ttname"><a href="class_hardware_manager.html#a26b5a0c399598a73399c33cb42195404">HardwareManager::lastPollTime</a></div><div class="ttdeci">unsigned long lastPollTime</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00036">HardwareManager.h:36</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a2e85929fcd71e50c6913d623577dbeb8"><div class="ttname"><a href="class_hardware_manager.html#a2e85929fcd71e50c6913d623577dbeb8">HardwareManager::adc</a></div><div class="ttdeci">ADC adc</div><div class="ttdoc">ADC manager for Teensy analog reads.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00061">HardwareManager.h:61</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a2ec9120b97897bbf139ce6364ec245fc"><div class="ttname"><a href="class_hardware_manager.html#a2ec9120b97897bbf139ce6364ec245fc">HardwareManager::bitIndex</a></div><div class="ttdeci">static volatile int bitIndex</div><div class="ttdoc">Serial transmission bit index.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00068">HardwareManager.h:68</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a315dc1caa02e610f91b1a612bda30b3f"><div class="ttname"><a href="class_hardware_manager.html#a315dc1caa02e610f91b1a612bda30b3f">HardwareManager::MuxAddressPins</a></div><div class="ttdeci">uint MuxAddressPins[4]</div><div class="ttdoc">Enable lines for each analog multiplexer.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00041">HardwareManager.h:41</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a323515123ec033d7e4761cd1ad0f7674"><div class="ttname"><a href="class_hardware_manager.html#a323515123ec033d7e4761cd1ad0f7674">HardwareManager::saveKnobs</a></div><div class="ttdeci">void saveKnobs()</div><div class="ttdoc">Saves the current knob configuration to EEPROM.</div><div class="ttdef"><b>Definition</b> <a href="#l00132">HardwareManager.cpp:132</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a389138f42e4c27721988b5f6482a47c1"><div class="ttname"><a href="class_hardware_manager.html#a389138f42e4c27721988b5f6482a47c1">HardwareManager::getKnobValue</a></div><div class="ttdeci">int getKnobValue(uint index)</div><div class="ttdoc">Retrieves the current analog value of the specified knob.</div><div class="ttdef"><b>Definition</b> <a href="#l00186">HardwareManager.cpp:186</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a48dad7203dfb3cdaa646678c0f4f16b4"><div class="ttname"><a href="class_hardware_manager.html#a48dad7203dfb3cdaa646678c0f4f16b4">HardwareManager::encoderKnob</a></div><div class="ttdeci">Encoder * encoderKnob</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00038">HardwareManager.h:38</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a4a7cab7ae0b5071b0557905000f46806"><div class="ttname"><a href="class_hardware_manager.html#a4a7cab7ae0b5071b0557905000f46806">HardwareManager::gatherControlSettings</a></div><div class="ttdeci">void gatherControlSettings()</div><div class="ttdoc">Reads all analog and digital inputs.</div><div class="ttdef"><b>Definition</b> <a href="#l00219">HardwareManager.cpp:219</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a518b4b1ddd898bd2a962392af422614f"><div class="ttname"><a href="class_hardware_manager.html#a518b4b1ddd898bd2a962392af422614f">HardwareManager::setButtonLights</a></div><div class="ttdeci">void setButtonLights(uint buttonId, bool red, bool green)</div><div class="ttdoc">Sets the LED colors for a button.</div><div class="ttdef"><b>Definition</b> <a href="#l00552">HardwareManager.cpp:552</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a53cce0263086fe32524936c007293847"><div class="ttname"><a href="class_hardware_manager.html#a53cce0263086fe32524936c007293847">HardwareManager::oldAnalogValues</a></div><div class="ttdeci">uint16_t oldAnalogValues[16][NUM_MUXES]</div><div class="ttdoc">Previous readings for comparison.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00044">HardwareManager.h:44</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a598987bc3663dc83206abb5d1d2119f5"><div class="ttname"><a href="class_hardware_manager.html#a598987bc3663dc83206abb5d1d2119f5">HardwareManager::greenIsLit</a></div><div class="ttdeci">bool greenIsLit(uint buttonId)</div><div class="ttdoc">Checks if the green LED is lit for a given button.</div><div class="ttdef"><b>Definition</b> <a href="#l00258">HardwareManager.cpp:258</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a5a834a463d4b5ef9e69a37001c60768e"><div class="ttname"><a href="class_hardware_manager.html#a5a834a463d4b5ef9e69a37001c60768e">HardwareManager::knobConfigurations_bkup</a></div><div class="ttdeci">knobConfig knobConfigurations_bkup[NUM_KNOBS]</div><div class="ttdoc">Backup mapping.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00071">HardwareManager.h:71</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a5ad8de42c31a9691549f22b7157919e2"><div class="ttname"><a href="class_hardware_manager.html#a5ad8de42c31a9691549f22b7157919e2">HardwareManager::getEncoderZeroTo</a></div><div class="ttdeci">long getEncoderZeroTo(long divisor)</div><div class="ttdoc">Returns a normalized encoder value in range [0, divisor).</div><div class="ttdef"><b>Definition</b> <a href="#l00103">HardwareManager.cpp:103</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a627129bb20508846f14c1f62220a4976"><div class="ttname"><a href="class_hardware_manager.html#a627129bb20508846f14c1f62220a4976">HardwareManager::buttonPins</a></div><div class="ttdeci">const uint8_t buttonPins[NUM_BUTTONS]</div><div class="ttdoc">GPIO pin numbers for each digital button.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00065">HardwareManager.h:65</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a69487280dacad30fc7fa1fd58e9e48ca"><div class="ttname"><a href="class_hardware_manager.html#a69487280dacad30fc7fa1fd58e9e48ca">HardwareManager::writeLedRegistersToHardware</a></div><div class="ttdeci">void writeLedRegistersToHardware()</div><div class="ttdoc">Pushes current LED state to shift registers.</div><div class="ttdef"><b>Definition</b> <a href="#l00415">HardwareManager.cpp:415</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a6a90392542468cb4d057b7e1aa3b2aad"><div class="ttname"><a href="class_hardware_manager.html#a6a90392542468cb4d057b7e1aa3b2aad">HardwareManager::hardwareManagerPollIntervalMS</a></div><div class="ttdeci">const unsigned long hardwareManagerPollIntervalMS</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00037">HardwareManager.h:37</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a6f45e846ef082a37a2bd2d3edf9efb5b"><div class="ttname"><a href="class_hardware_manager.html#a6f45e846ef082a37a2bd2d3edf9efb5b">HardwareManager::loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Main polling loop, throttled to a fixed interval.</div><div class="ttdef"><b>Definition</b> <a href="#l00164">HardwareManager.cpp:164</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a73027e69fad5aa613c3fe4ed0af7b6da"><div class="ttname"><a href="class_hardware_manager.html#a73027e69fad5aa613c3fe4ed0af7b6da">HardwareManager::buttonStateChanged</a></div><div class="ttdeci">bool buttonStateChanged(uint index, bool bDirection, bool bClearFlag)</div><div class="ttdoc">Detects state changes on buttons.</div><div class="ttdef"><b>Definition</b> <a href="#l00304">HardwareManager.cpp:304</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a75f06e4bc04d08d6be6e61bc7e3880c9"><div class="ttname"><a href="class_hardware_manager.html#a75f06e4bc04d08d6be6e61bc7e3880c9">HardwareManager::recentCommands</a></div><div class="ttdeci">std::vector&lt; SentCommand &gt; recentCommands</div><div class="ttdoc">Rolling log of recently sent PG-800 commands.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00067">HardwareManager.h:67</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a7777c52d0ef47ddf60e84beeedf39cc0"><div class="ttname"><a href="class_hardware_manager.html#a7777c52d0ef47ddf60e84beeedf39cc0">HardwareManager::resetEncoder</a></div><div class="ttdeci">void resetEncoder(uint i)</div><div class="ttdoc">Resets the encoders internal count to a specific value.</div><div class="ttdef"><b>Definition</b> <a href="#l00375">HardwareManager.cpp:375</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a8ad6a46ff803f39bbe5c7b99d5dc1118"><div class="ttname"><a href="class_hardware_manager.html#a8ad6a46ff803f39bbe5c7b99d5dc1118">HardwareManager::analogInPins</a></div><div class="ttdeci">const uint8_t analogInPins[NUM_MUXES]</div><div class="ttdoc">ADC pins corresponding to each MUX.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00064">HardwareManager.h:64</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a8ccfd2a833eb6826587dba7a4d97c331"><div class="ttname"><a href="class_hardware_manager.html#a8ccfd2a833eb6826587dba7a4d97c331">HardwareManager::knobChanged</a></div><div class="ttdeci">bool knobChanged(int i)</div><div class="ttdoc">Detects change in knob value.</div><div class="ttdef"><b>Definition</b> <a href="#l00156">HardwareManager.cpp:156</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a8f6720aad631557b7254da5f7ff356ed"><div class="ttname"><a href="class_hardware_manager.html#a8f6720aad631557b7254da5f7ff356ed">HardwareManager::AnalogValues</a></div><div class="ttdeci">uint16_t AnalogValues[16][NUM_MUXES]</div><div class="ttdoc">Latest analog readings from all knobs.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00043">HardwareManager.h:43</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a9b7836f6542d76f66a18dd266c8ff268"><div class="ttname"><a href="class_hardware_manager.html#a9b7836f6542d76f66a18dd266c8ff268">HardwareManager::lastPotScanTime</a></div><div class="ttdeci">long lastPotScanTime</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00059">HardwareManager.h:59</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_a9e49dcb61d28890a831708d669eebed6"><div class="ttname"><a href="class_hardware_manager.html#a9e49dcb61d28890a831708d669eebed6">HardwareManager::saveLedState</a></div><div class="ttdeci">void saveLedState()</div><div class="ttdoc">Saves the current LED state to internal memory.</div><div class="ttdef"><b>Definition</b> <a href="#l00520">HardwareManager.cpp:520</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_aaa16c700ab58fcc9b2b8a33ff4f3090d"><div class="ttname"><a href="class_hardware_manager.html#aaa16c700ab58fcc9b2b8a33ff4f3090d">HardwareManager::getEncoderValue</a></div><div class="ttdeci">long getEncoderValue()</div><div class="ttdoc">Returns raw encoder position.</div><div class="ttdef"><b>Definition</b> <a href="#l00407">HardwareManager.cpp:407</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_aac5863c15f10f28dc888d496eadf0d70"><div class="ttname"><a href="class_hardware_manager.html#aac5863c15f10f28dc888d496eadf0d70">HardwareManager::restoreLedState</a></div><div class="ttdeci">void restoreLedState()</div><div class="ttdoc">Restores the previously saved LED state.</div><div class="ttdef"><b>Definition</b> <a href="#l00527">HardwareManager.cpp:527</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_aaf70a4835af8352a2af86b9679b89d41"><div class="ttname"><a href="class_hardware_manager.html#aaf70a4835af8352a2af86b9679b89d41">HardwareManager::loadKnobs</a></div><div class="ttdeci">void loadKnobs()</div><div class="ttdoc">Loads the knob configuration from EEPROM or persistent storage.</div><div class="ttdef"><b>Definition</b> <a href="#l00118">HardwareManager.cpp:118</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ab14567b2aa576fcbe6f8be034b3c6427"><div class="ttname"><a href="class_hardware_manager.html#ab14567b2aa576fcbe6f8be034b3c6427">HardwareManager::prevLedState</a></div><div class="ttdeci">uint8_t prevLedState</div><div class="ttdoc">Bitfield representing previous LED state.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00050">HardwareManager.h:50</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ab2810a18f676cb33b5696d59a61caf1b"><div class="ttname"><a href="class_hardware_manager.html#ab2810a18f676cb33b5696d59a61caf1b">HardwareManager::gatherPotentiometerValues</a></div><div class="ttdeci">void gatherPotentiometerValues()</div><div class="ttdoc">Reads and stores current potentiometer values.</div><div class="ttdef"><b>Definition</b> <a href="#l00337">HardwareManager.cpp:337</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ab9756835f0b098ac288628f4c4139ca2"><div class="ttname"><a href="class_hardware_manager.html#ab9756835f0b098ac288628f4c4139ca2">HardwareManager::knobConfigurations</a></div><div class="ttdeci">knobConfig knobConfigurations[NUM_KNOBS]</div><div class="ttdoc">Current knob-to-parameter mapping.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00070">HardwareManager.h:70</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_abd678fae41765624bb05aed23f7a1785"><div class="ttname"><a href="class_hardware_manager.html#abd678fae41765624bb05aed23f7a1785">HardwareManager::redIsLit</a></div><div class="ttdeci">bool redIsLit(uint buttonId)</div><div class="ttdoc">Checks if the red LED is lit for a given button.</div><div class="ttdef"><b>Definition</b> <a href="#l00240">HardwareManager.cpp:240</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ac05c3327a4bedb62f953d15f64c98348"><div class="ttname"><a href="class_hardware_manager.html#ac05c3327a4bedb62f953d15f64c98348">HardwareManager::isButtonPressed</a></div><div class="ttdeci">bool isButtonPressed(uint index)</div><div class="ttdoc">Returns true if the specified button is currently pressed.</div><div class="ttdef"><b>Definition</b> <a href="#l00200">HardwareManager.cpp:200</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ac54dcfe2d8157035648e18095430633d"><div class="ttname"><a href="class_hardware_manager.html#ac54dcfe2d8157035648e18095430633d">HardwareManager::enablePins</a></div><div class="ttdeci">uint enablePins[NUM_MUXES]</div><div class="ttdoc">Enable lines for each analog multiplexer.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00040">HardwareManager.h:40</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ac803df51783435becad4e0719e3de1d3"><div class="ttname"><a href="class_hardware_manager.html#ac803df51783435becad4e0719e3de1d3">HardwareManager::bPrevEncoderBtn</a></div><div class="ttdeci">bool bPrevEncoderBtn</div><div class="ttdoc">Previous encoder button state.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00054">HardwareManager.h:54</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_acbee566327ea9e237566823f46dfcac5"><div class="ttname"><a href="class_hardware_manager.html#acbee566327ea9e237566823f46dfcac5">HardwareManager::init</a></div><div class="ttdeci">void init()</div><div class="ttdoc">Initializes hardware peripherals: GPIO, ADC, encoder, etc.</div><div class="ttdef"><b>Definition</b> <a href="#l00028">HardwareManager.cpp:28</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_acc9496217a58084ae0af83c58cf658ea"><div class="ttname"><a href="class_hardware_manager.html#acc9496217a58084ae0af83c58cf658ea">HardwareManager::sendParameter</a></div><div class="ttdeci">void sendParameter(uint8_t paramID, uint8_t value)</div><div class="ttdoc">Sends a parameter command over the serial protocol.</div><div class="ttdef"><b>Definition</b> <a href="#l00444">HardwareManager.cpp:444</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_acfc375a757daaa27f18d76c67f18307f"><div class="ttname"><a href="class_hardware_manager.html#acfc375a757daaa27f18d76c67f18307f">HardwareManager::sendBuffer</a></div><div class="ttdeci">static volatile uint16_t sendBuffer</div><div class="ttdoc">Serial transmission buffer.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00069">HardwareManager.h:69</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ad30a99fa8e93d030b058e41f6e60dcae"><div class="ttname"><a href="class_hardware_manager.html#ad30a99fa8e93d030b058e41f6e60dcae">HardwareManager::prevButtonStates</a></div><div class="ttdeci">uint8_t prevButtonStates[NUM_BUTTONS]</div><div class="ttdoc">Previous digital button states.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00047">HardwareManager.h:47</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ae270bdec0bf6dbb5a0558aec3858c5ce"><div class="ttname"><a href="class_hardware_manager.html#ae270bdec0bf6dbb5a0558aec3858c5ce">HardwareManager::ledstate</a></div><div class="ttdeci">uint8_t ledstate</div><div class="ttdoc">Bitfield representing current LED state.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00049">HardwareManager.h:49</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_ae436f35ee0851ca0dad3f0f0c9ad83ea"><div class="ttname"><a href="class_hardware_manager.html#ae436f35ee0851ca0dad3f0f0c9ad83ea">HardwareManager::onPG800ClockFall</a></div><div class="ttdeci">static void onPG800ClockFall()</div><div class="ttdoc">ISR for clocking out serial bits.</div><div class="ttdef"><b>Definition</b> <a href="#l00493">HardwareManager.cpp:493</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_aef067455e10624433ddd360794012151"><div class="ttname"><a href="class_hardware_manager.html#aef067455e10624433ddd360794012151">HardwareManager::setAddressPins</a></div><div class="ttdeci">void setAddressPins(uint val)</div><div class="ttdoc">Sets the MUX address lines.</div><div class="ttdef"><b>Definition</b> <a href="#l00362">HardwareManager.cpp:362</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_af204c2f4a3e3e12dbd79a9c910f5979c"><div class="ttname"><a href="class_hardware_manager.html#af204c2f4a3e3e12dbd79a9c910f5979c">HardwareManager::getKnobConfiguration</a></div><div class="ttdeci">knobConfig getKnobConfiguration(uint i)</div><div class="ttdoc">Retrieves the configuration associated with a given knob.</div><div class="ttdef"><b>Definition</b> <a href="#l00537">HardwareManager.cpp:537</a></div></div>
<div class="ttc" id="aclass_hardware_manager_html_af4761cefe4c6093de549ae7e5dde75b9"><div class="ttname"><a href="class_hardware_manager.html#af4761cefe4c6093de549ae7e5dde75b9">HardwareManager::lastEncoderPosition</a></div><div class="ttdeci">long lastEncoderPosition</div><div class="ttdoc">Last recorded rotary encoder position.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00057">HardwareManager.h:57</a></div></div>
<div class="ttc" id="adefines_8h_html"><div class="ttname"><a href="defines_8h.html">defines.h</a></div><div class="ttdoc">Hardware pin definitions and global constants for JMR800-V2.</div></div>
<div class="ttc" id="adefines_8h_html_a006a61e230d20d998a18bf2fbf562947"><div class="ttname"><a href="defines_8h.html#a006a61e230d20d998a18bf2fbf562947">NUM_MUXES</a></div><div class="ttdeci">#define NUM_MUXES</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00032">defines.h:32</a></div></div>
<div class="ttc" id="adefines_8h_html_a080eb3794855f7da383bb3d59aa51b86"><div class="ttname"><a href="defines_8h.html#a080eb3794855f7da383bb3d59aa51b86">PUSH_BTN_SW3_PIN</a></div><div class="ttdeci">#define PUSH_BTN_SW3_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00044">defines.h:44</a></div></div>
<div class="ttc" id="adefines_8h_html_a1ee5f4c034a6dbd7f5f9d30a7c7621d7"><div class="ttname"><a href="defines_8h.html#a1ee5f4c034a6dbd7f5f9d30a7c7621d7">PUSH_BTN_SW1_PIN</a></div><div class="ttdeci">#define PUSH_BTN_SW1_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00046">defines.h:46</a></div></div>
<div class="ttc" id="adefines_8h_html_a3c79e4c4e3c98acfbb5ce2610850c837"><div class="ttname"><a href="defines_8h.html#a3c79e4c4e3c98acfbb5ce2610850c837">SHIFT_REG_SRCLK</a></div><div class="ttdeci">#define SHIFT_REG_SRCLK</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00053">defines.h:53</a></div></div>
<div class="ttc" id="adefines_8h_html_a3cee117709e9b71f2384746e11d846b8"><div class="ttname"><a href="defines_8h.html#a3cee117709e9b71f2384746e11d846b8">DATA_OUT_PIN</a></div><div class="ttdeci">#define DATA_OUT_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00037">defines.h:37</a></div></div>
<div class="ttc" id="adefines_8h_html_a3e2406b11040fab176d3ae938bb36fb4"><div class="ttname"><a href="defines_8h.html#a3e2406b11040fab176d3ae938bb36fb4">PUSH_BTN_SW2_PIN</a></div><div class="ttdeci">#define PUSH_BTN_SW2_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00045">defines.h:45</a></div></div>
<div class="ttc" id="adefines_8h_html_a44723db4e11f34a0ad8759574d637e1d"><div class="ttname"><a href="defines_8h.html#a44723db4e11f34a0ad8759574d637e1d">S0_PIN</a></div><div class="ttdeci">#define S0_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00027">defines.h:27</a></div></div>
<div class="ttc" id="adefines_8h_html_a45add6b39f5b0c0137de978b90e26b5d"><div class="ttname"><a href="defines_8h.html#a45add6b39f5b0c0137de978b90e26b5d">NUM_BUTTONS</a></div><div class="ttdeci">#define NUM_BUTTONS</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00049">defines.h:49</a></div></div>
<div class="ttc" id="adefines_8h_html_a541f931e7d08042d778592d4f38bd403"><div class="ttname"><a href="defines_8h.html#a541f931e7d08042d778592d4f38bd403">PUSH_BTN_SW4_PIN</a></div><div class="ttdeci">#define PUSH_BTN_SW4_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00043">defines.h:43</a></div></div>
<div class="ttc" id="adefines_8h_html_a69905d626cf4151cb01579783c88c863"><div class="ttname"><a href="defines_8h.html#a69905d626cf4151cb01579783c88c863">ENCODER_CLK_PIN</a></div><div class="ttdeci">#define ENCODER_CLK_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00057">defines.h:57</a></div></div>
<div class="ttc" id="adefines_8h_html_a7e66659a0a4957d6723f5d750a08a14d"><div class="ttname"><a href="defines_8h.html#a7e66659a0a4957d6723f5d750a08a14d">SHIFT_REG_SER</a></div><div class="ttdeci">#define SHIFT_REG_SER</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00052">defines.h:52</a></div></div>
<div class="ttc" id="adefines_8h_html_a8766620bcdd3b4ffdae69e99def6458e"><div class="ttname"><a href="defines_8h.html#a8766620bcdd3b4ffdae69e99def6458e">S1_PIN</a></div><div class="ttdeci">#define S1_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00028">defines.h:28</a></div></div>
<div class="ttc" id="adefines_8h_html_a87f435a777fc58e1d3c4630bb8e632b3"><div class="ttname"><a href="defines_8h.html#a87f435a777fc58e1d3c4630bb8e632b3">NUM_KNOBS</a></div><div class="ttdeci">#define NUM_KNOBS</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00069">defines.h:69</a></div></div>
<div class="ttc" id="adefines_8h_html_aaf8543438455236887373a4b15f25ce8"><div class="ttname"><a href="defines_8h.html#aaf8543438455236887373a4b15f25ce8">CLOCK_IN_PIN</a></div><div class="ttdeci">#define CLOCK_IN_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00036">defines.h:36</a></div></div>
<div class="ttc" id="adefines_8h_html_ac85e335442c235cb773d5742c9ef85bb"><div class="ttname"><a href="defines_8h.html#ac85e335442c235cb773d5742c9ef85bb">ENCODER_DT_PIN</a></div><div class="ttdeci">#define ENCODER_DT_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00058">defines.h:58</a></div></div>
<div class="ttc" id="adefines_8h_html_ad35e229b7d7271d26abe3244374f7159"><div class="ttname"><a href="defines_8h.html#ad35e229b7d7271d26abe3244374f7159">SHIFT_REG_RCLK</a></div><div class="ttdeci">#define SHIFT_REG_RCLK</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00054">defines.h:54</a></div></div>
<div class="ttc" id="adefines_8h_html_ad50338afe7b10c1aa188fde925109853"><div class="ttname"><a href="defines_8h.html#ad50338afe7b10c1aa188fde925109853">S2_PIN</a></div><div class="ttdeci">#define S2_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00029">defines.h:29</a></div></div>
<div class="ttc" id="adefines_8h_html_ae6596c668bf9f30d1c6a52785ae33f79"><div class="ttname"><a href="defines_8h.html#ae6596c668bf9f30d1c6a52785ae33f79">READYOUT_PIN</a></div><div class="ttdeci">#define READYOUT_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00035">defines.h:35</a></div></div>
<div class="ttc" id="adefines_8h_html_ae80cab24ae384f8a20b28d725e0761a8"><div class="ttname"><a href="defines_8h.html#ae80cab24ae384f8a20b28d725e0761a8">ENCODER_SW_PIN</a></div><div class="ttdeci">#define ENCODER_SW_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00059">defines.h:59</a></div></div>
<div class="ttc" id="adefines_8h_html_aeff05ff93deed7ec7c197dfded858bda"><div class="ttname"><a href="defines_8h.html#aeff05ff93deed7ec7c197dfded858bda">S3_PIN</a></div><div class="ttdeci">#define S3_PIN</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00030">defines.h:30</a></div></div>
<div class="ttc" id="astruct_sent_command_html"><div class="ttname"><a href="struct_sent_command.html">SentCommand</a></div><div class="ttdoc">Represents a parameter-value pair sent to external hardware along with a timestamp.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00023">HardwareManager.h:23</a></div></div>
<div class="ttc" id="astruct_sent_command_html_a6bd03f07367c4a7a8033c4f2f8183fe1"><div class="ttname"><a href="struct_sent_command.html#a6bd03f07367c4a7a8033c4f2f8183fe1">SentCommand::paramID</a></div><div class="ttdeci">uint8_t paramID</div><div class="ttdoc">PG-800 parameter ID.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00024">HardwareManager.h:24</a></div></div>
<div class="ttc" id="astruct_sent_command_html_aa7341c37b068a4b56a108fb90990d102"><div class="ttname"><a href="struct_sent_command.html#aa7341c37b068a4b56a108fb90990d102">SentCommand::value</a></div><div class="ttdeci">uint8_t value</div><div class="ttdoc">Value associated with the parameter.</div><div class="ttdef"><b>Definition</b> <a href="_hardware_manager_8h_source.html#l00025">HardwareManager.h:25</a></div></div>
<div class="ttc" id="astructknob_config_html"><div class="ttname"><a href="structknob_config.html">knobConfig</a></div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00075">defines.h:75</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="_hardware_manager_8cpp.html">HardwareManager.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
